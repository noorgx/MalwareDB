# Malware Database Downloader

## Overview
This script automates the process of downloading, extracting, and analyzing malware samples from the **Malware Bazaar** daily database, enhancing the original work from [0xmr-robot's blog post](https://0xmr-robot.github.io/posts/Building-Your-Arsenal-Automated-Malware-Collection/). The main goal is to speed up the workflow, provide additional features, and improve automation for users interested in malware research and analysis.

## Key Features

1. **Download Malware Samples:**
   - Download individual files by date or multiple files within a specific date range.
   - Option to download all files since **2020-02-24**. This feature may require significant disk space due to the large number of samples.
   
2. **Multithreaded & Multiprocessing Support:**
   - Use multithreading to download and unzip files faster.
   - Distribute unzipping tasks across multiple processes to maximize system resource utilization.

3. **Automatic Unzipping:**
   - Unzips downloaded files with the default password `infected`.
   - Prompts the user for the password if the default one fails.
   - Option to use a multithreaded method for faster unzipping.

4. **Hash Calculation:**
   - Calculate MD5, SHA1, and SHA256 hashes for downloaded malware samples.
   - Save hash values in respective text files inside the malware sample's folder.

5. **Organized Storage:**
   - After unzipping, each file is renamed using its SHA256 hash and moved to a folder named after the hash, ensuring a clean and organized storage structure for further analysis.

## Script Workflow

1. **Download Samples:**
   - The user is prompted to download a single file, a range of files, or all available files.
   - Files are fetched from `https://datalake.abuse.ch/malware-bazaar/daily/`.

2. **Unzip Files:**
   - After downloading, the script can automatically unzip the files using either single-threaded or multithreaded methods.
   - If the provided password (`infected`) fails, the user is prompted to enter a password manually.

3. **Hash Calculation:**
   - The user can opt to calculate the hashes (MD5, SHA1, SHA256) of the unzipped files.
   - The hash values are saved in text files for each malware sample, which are then renamed and organized by hash.

4. **Automated Renaming and Organization:**
   - Each file is renamed with a `.malz` extension and moved to a folder named after its SHA256 hash, keeping everything neatly structured.

## Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/noorgx/MalwareDB.git
   cd MalwareDB
   ```

2. Install the required dependencies:
   ```bash
   pip install -r requirements.txt
   ```

   The required packages include:
   - `requests`
   - `tqdm`
   - `termcolor`
   - `concurrent.futures`
   - `hashlib`

## Usage

1. Run the script:
   ```bash
   python Malzdb.py
   ```

2. Follow the interactive prompts:
   - **Single File Download**: Enter the date of the file to download (in `YYYY-MM-DD` format).
   - **Multiple Files Download**: Enter a start and end date to download files in that range.
   - **All Files Download**: Downloads all files available since 2020-02-24.

3. Choose to unzip files and calculate hashes (optional). You will be prompted for this after downloading the files.

4. Optionally, enable multithreaded unzipping for faster file extraction.

## Improvements Over the Original

This script is an enhanced version of [0xmr-robot's original script](https://0xmr-robot.github.io/posts/Building-Your-Arsenal-Automated-Malware-Collection/), with the following added features:

- **Multithreading for Faster Downloads and Unzipping**.
- **Retry Mechanism** for failed downloads.
- **Organized Storage**: Automatically renames files based on their SHA256 hash and moves them into dedicated folders.
- **Multiple Hash Algorithms Support**: Added functionality to calculate and store MD5, SHA1, and SHA256 hashes.
- **Improved Error Handling**: More robust error handling during downloading, unzipping, and hash calculation.

## Example

Here is a typical example of running the script:

1. Downloading a range of files:
   ```bash
   Enter 'M' to download multiple files
   Enter start date (YYYY-MM-DD): 2023-09-01
   Enter end date (YYYY-MM-DD): 2023-09-07
   ```
   This will download all files from September 1st to September 7th, 2023.

2. Unzipping and calculating hashes:
   ```bash
   Do you want to unzip all downloaded files? (Y/N): Y
   Do you want to unzip all downloaded files in multithreaded mode? (Y/N): Y
   Do you want to calculate the hash of each file? (Y/N): Y
   Enter the hashing algorithm (md5, sha1, sha2, all): all
   ```

This command unzips all downloaded files, calculates their hashes (MD5, SHA1, and SHA256), and organizes the files by their hash value.

## Notes

- **Storage Requirements**: Downloading all available files since 2020 will require significant disk space, so ensure you have enough storage.
- **Error Handling**: The script will attempt to download and process files even if some of the downloads fail due to network issues. A retry mechanism is in place, but itâ€™s recommended to monitor long download sessions.

